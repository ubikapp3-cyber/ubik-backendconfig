server:
  port: 8080


spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      # Global CORS configuration
      globalcors:
        cors-configurations:
          '[/**]':
            allowed-origins: ${ALLOWED_ORIGINS:http://localhost:4200,http://localhost:3000}
            allowed-methods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowed-headers: ${ALLOWED_HEADERS:Content-Type,Authorization,X-Requested-With}
            exposed-headers:
              - X-User-Id
              - X-User-Role
              - X-Error-Message
            allow-credentials: true
            max-age: 3600

      routes:
        # MICROSERVICIO userManagement (autenticaci√≥n: login, register)
        - id: userManagement-auth
          uri: http://localhost:8081
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=0

        # MICROSERVICIO userManagement (datos del usuario)
        - id: userManagement-profile
          uri: http://localhost:8081
          predicates:
            - Path=/api/user/**
          filters:
            - StripPrefix=0
            - name: AuthorizationFilter

        # Motel Management - Motels
        - id: motel-management-motels
          uri: http://localhost:8084
          predicates:
            - Path=/api/motels/**
          filters:
            - StripPrefix=0
            - name: AuthorizationFilter

        # Motel Management - Rooms
        - id: motel-management-rooms
          uri: http://localhost:8084
          predicates:
            - Path=/api/rooms/**
          filters:
            - StripPrefix=0
            - name: AuthorizationFilter

        # Motel Management - Services
        - id: motel-management-services
          uri: http://localhost:8084
          predicates:
            - Path=/api/services/**
          filters:
            - StripPrefix=0
            - name: AuthorizationFilter

        # Booking Service - Reservations
        - id: motel-management-bookings
          uri: http://localhost:8084
          predicates:
            - Path=/api/bookings/**
          filters:
            - StripPrefix=0
            - name: AuthorizationFilter

      # Para evitar problemas de proxies locales
      trusted-proxies: '127\.0\.0\.1|::1'

# JWT Configuration
jwt:
  secret: ${JWT_SECRET:}
  expiration: ${JWT_EXPIRATION:86400000}

# Logging configuration
logging:
  level:
    com.example.gateway: DEBUG
    org.springframework.cloud.gateway: DEBUG

management:
  endpoints:
    web:
      exposure:
        include: "health,info,metrics,gateway"

# OpenAPI/Swagger Configuration
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha