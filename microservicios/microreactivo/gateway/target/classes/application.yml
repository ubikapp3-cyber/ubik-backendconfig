server:
  port: 8080


spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      # Global CORS configuration
      globalcors:
        cors-configurations:
          '[/**]':
            allowed-origins: "*"
            allowed-methods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowed-headers: "*"
            exposed-headers:
              - X-User-Id
              - X-User-Role
              - X-Error-Message
            allow-credentials: false
            max-age: 3600

      routes:
        # MICROSERVICIO userManagement (autenticaci√≥n: login, register)
        - id: userManagement-auth
          uri: http://localhost:8081
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=0

        # MICROSERVICIO userManagement (datos del usuario)
        - id: userManagement-profile
          uri: http://localhost:8081
          predicates:
            - Path=/api/user/**
          filters:
            - StripPrefix=0
            - name: AuthorizationFilter

        # Products Service
        - id: products
          uri: http://localhost:8082
          predicates:
            - Path=/api/products/**
          filters:
            - StripPrefix=1
            - name: AuthorizationFilter

        # Motel Management - Motels
        - id: motel-management-motels
          uri: http://localhost:8083
          predicates:
            - Path=/api/motels/**
          filters:
            - StripPrefix=0

        # Motel Management - Rooms
        - id: motel-management-rooms
          uri: http://localhost:8083
          predicates:
            - Path=/api/rooms/**
          filters:
            - StripPrefix=0
            - name: AuthorizationFilter

        # Motel Management - Services
        - id: motel-management-services
          uri: http://localhost:8083
          predicates:
            - Path=/api/services/**
          filters:
            - StripPrefix=0
            - name: AuthorizationFilter

        # Booking Service - Reservations
        - id: booking-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/bookings/**
          filters:
            - StripPrefix=0
            - name: AuthorizationFilter

      # Para evitar problemas de proxies locales
      trusted-proxies: '127\.0\.0\.1|::1'

# JWT Configuration
jwt:
  secret: mySecretKey1234567890abcdef1234567890abcdef
  expiration: 86400000

# Logging configuration
logging:
  level:
    com.example.gateway: DEBUG
    org.springframework.cloud.gateway: DEBUG

management:
  endpoints:
    web:
      exposure:
        include: "health,info,metrics,gateway"